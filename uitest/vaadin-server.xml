<?xml version="1.0"?>
<project xmlns:antcontrib="antlib:net.sf.antcontrib" xmlns:ivy="antlib:org.apache.ivy.ant" name="vaadin-server" default="deploy-and-start" basedir=".">
	<include file="../common.xml" />

	<target name="deploy-and-start">
		<fail unless="war.file" message="No war file given in 'war.file'" />

		<ivy:resolve file="ivy.xml" />
		<ivy:cachepath pathid="classpath.jetty" conf="jetty-run" />
		<java classname="org.mortbay.jetty.runner.Runner" fork="yes">
			<arg value="--port" />
			<arg value="8888" />
			<arg value="${war.file}" />
			<classpath refid="classpath.jetty" />
			<jvmarg value="-ea" />
		</java>

	</target>

	<target name="wait-for-startup">
		<echo>Waiting for Servlet Container to start up.</echo>
		<waitfor maxwait="60" maxwaitunit="second" checkevery="5" checkeveryunit="second" timeoutproperty="server.start.failed">
			<http url="http://localhost:8888" />
		</waitfor>
		<fail if="server.start.failed" message="Server startup failed" />
	</target>

</project>
